<html>

  <head>
    <title>OHMS Admin Panel</title>
    <link href="{{options.base_url}}/{{options.static}}/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{options.base_url}}/{{options.static}}/css/style.css" rel="stylesheet">
  </head>

  <body>

    <div class="span12">

    <h2>OHMS Admin Panel</h2>

    <hr/>

    <h3>Enter User View</h3>

    <p>This feature allows you to see the system from the perspective of any user. This is useful in case a student claims 
there is a problem with the system, and you would like to see what they're seeing.</p>

    <p><b><font color="red">Warning!</font></b> Once you enter the user's view, the link to this Admin Panel will no longer be visible 
from the main page. When you  are ready to switch back to your own view, you must type in the URL (<tt>/cgi-bin/index.cgi/admin</tt>) 
to return to this page. Once you are here, you can simply enter your User ID in the box below to return to your own view.</p>

    <form action="change_user" method="POST">
    User ID: <input type="text" name="user"/> <input type="submit" value="Enter View!"/>
    </form>

    <hr/>

    <h3>Gradebook</h3>

    <p class="lead">Click <a href="download_grades">here</a> to download the grades as a CSV file.</p>

    <strong>How to use the Gradebook:</strong>

    <ul>
      <li>Grades are only shown for students in the class. It is recommended that you change the 
status of any user who is not enrolled in the class to "Guest".</li>
      <li>Click on the name of any assignment to view a histogram of the scores for that 
assignment. This will also hide all columns except for that column, making it easier to 
enter scores.</li>
      <li>To excuse a student from an assignment, enter an "E" in the blank where the score 
would go. This ensures that the lost points on the assignment do not count against the student, 
by adjusting the denominator in the total points.</li>
    </ul>

    <div align="center">
      <div id="histogram" class="span12"></div>
      <div id="missing" class="span12"></div>
      <div id="excused" class="span12"></div>
      <div id="stats" class="lead"></div>
    </div>

    <table id="gradebook" class="table table-striped">
      <thead>
	<th>Student Name</th>
	<th>User ID</th>
	<th>Type</th>

	<th><a href="#" onclick="hide_all_other_columns(4)">Overall</a></th>

	{% for category in categories %}
	<th><a href="#" onclick="hide_all_other_columns({{ 4 + loop.index }})">{{ category.name }} Total</a></th>
	{% endfor %}

	{% for homework in homeworks %}
	<th><a href="#" onclick="hide_all_other_columns({{ 4 + categories|length + loop.index }})">{{ homework.name }}</a></th>
	{% endfor %}
      </thead>
      <tbody>
	{% for student, grades in gradebook %}
        <tr stuid="{{ student.stuid }}">
	  <td>{{ student.name }}</td>
	  <td>{{ student.stuid }}</td>
	  <td>
	    <form target="_blank" action="change_user_type" method="POST">
	      <input type="hidden" name="user" value="{{ student.stuid }}" />
	      <select name="type" class="input-small">
		<option value="student" selected>Student</option>
		<option value="guest">Guest</option>
		<option value="admin">Admin</option>
	      </select>
	      <input type="submit" value="Update!" />
	    </form>
	  </td>

	  <td value={{ grades["overall"]|round(3) }}>{{ grades["overall"]|round(1) }}%</td>

	  {% for category in categories %}
	  <td value={{ grades[category.name] }}>{{ grades[category.name] }}</td>
	  {% endfor %}
	  {% for hw in homeworks %}
	  <td hw_id="{{ hw.id }}" value="{% if hw.id in grades %}{{
					 grades[hw.id].score }}{% endif
					 %}">
	    {% if hw.questions|length %}
	      {% if hw.id in grades %}{{ grades[hw.id].score }}{% endif %}
	    {% else %}
	    <input type="text" class="input-mini grade" 
		   value="{% if hw.id in grades %}{{ grades[hw.id].score }}{% endif %}"/></td>
	    {% endif %}
	  {% endfor %}
	</tr>
	{% endfor %}
      </tbody>
    </table>

    <hr/>

    <h3>Other Users</h3>

    <table class="table">
      <thead>
	<th>Guests</th>
	<th>Actions</th>
      </thead>
      {% for guest in guests %}
        <tr>
	  <td>{{ guest.name }}</td>
	  <form target="_blank" action="change_user_type" method="POST">
	  <td>
	    <input type="hidden" name="user" value="{{ guest.stuid }}" />
	    <select name="type" class="input-small">
	      <option value="student">Student</option>
	      <option value="guest" selected>Guest</option>
	      <option value="admin">Admin</option>
	    </select>
	    <input type="submit" value="Update!" />
	  </td>
	  </form>
	</tr>
      {% endfor %}
    </table>

    <table class="table">
      <thead>
	<th>Admins</th>
	<th>Actions</th>
      </thead>
      {% for admin in admins %}
        <tr>
	  <td>{{ admin.name }}</td>
	  <form target="_blank" action="change_user_type" method="POST">
	  <td>
	    <input type="hidden" name="user" value="{{ admin.stuid }}" />
	    <select name="type" class="input-small">
	      <option value="student">Student</option>
	      <option value="guest">Guest</option>
	      <option value="admin" selected>Admin</option>
	    </select>
	    <input type="submit" value="Update!" />
	  </td>
	  </form>
	</tr>
      {% endfor %}
    </table>

    </div>

    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="{{options.base_url}}/{{options.static}}/js/admin/index.js"></script>

  </body>

</html>
