<html>

  <head>
    <title>OHMS Admin Panel</title>
    <link href="{{options.base_url}}/{{options.static}}/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{options.base_url}}/{{options.static}}/css/style.css" rel="stylesheet">
  </head>

  <body>

    <div class='span12'>

    <h2>OHMS Admin Panel</h2>

    <hr/>

    <h3>Enter User View</h3>

    <p>This feature allows you to see the system from the perspective of any user. This is useful in case a student claims 
there is a problem with the system, and you would like to see what they're seeing.</p>

    <p><b><font color="red">Warning!</font></b> Once you enter the user's view, the link to this Admin Panel will no longer be visible 
from the main page. When you  are ready to switch back to your own view, you must type in the URL (<tt>/cgi-bin/index.cgi/admin</tt>) 
to return to this page. Once you are here, you can simply enter your User ID in the box below to return to your own view.</p>

    <form action="change_user" method="POST">
    User ID: <input type="text" name="user"/> <input type="submit" value="Enter View!"/>
    </form>

    <hr/>

    <h3>Gradebook</h3>

    <p>Grades are only shown for students in the class. To remove a student from the list, change his or her status to "Guest". To hide all columns except for one (useful if you are entering grades), click the header of the column you want to keep.</p>

    <script type="text/javascript">
    function hide_all_other_columns(i) {
      var table = $("table#gradebook");
      for(var j=0; j<{{gradebook[0][1]|length}}; j++)
        if(j !== i)
          table.find('td:nth-child(' + (j+4) + '),th:nth-child(' + (j+4) + ')').hide();
    }
    </script>

    <table id="gradebook" class="table table-striped">
      <thead>
	<th>Student Name</th>
	<th>User ID</th>
	<th>Type</th>
	{% for homework, grade in gradebook[0][1] %}
	<th><a href="#" onclick="hide_all_other_columns({{ loop.index0 }})">{{ homework.name }}</th>
	{% endfor %}
      </thead>
      <tbody>
	{% for student, grades in gradebook %}
        <tr stuid="{{ student.stuid }}">
	  <td>{{ student.name }}</td>
	  <td>{{ student.stuid }}</td>
	  <td>
	    <form target="_blank" action="change_user_type" method="POST">
	      <input type="hidden" name="user" value="{{ student.stuid }}" />
	      <select name="type" class="input-small">
		<option value="student" selected>Student</option>
		<option value="guest">Guest</option>
		<option value="admin">Admin</option>
	      </select>
	      <input type="submit" value="Update!" />
	    </form>
	  </td>
	  {% for homework, grade in grades %}
	  <td hw_id="{{ homework.id }}">
	    {% if homework.questions|length %}
	    {{ grade.score }}
	    {% else %}
	    <input type="text" class="input-mini grade" 
		   value="{% if grade %}{{ grade.score }}{% endif %}"/></td>
	    {% endif %}
	  {% endfor %}
	</tr>
	{% endfor %}
      </tbody>
    </table>

    <hr/>

    <h3>Other Users</h3>

    <table class="table">
      <thead>
	<th>Guests</th>
	<th>Actions</th>
      </thead>
      {% for guest in guests %}
        <tr>
	  <td>{{ guest.name }}</td>
	  <form target="_blank" action="change_user_type" method="POST">
	  <td>
	    <input type="hidden" name="user" value="{{ guest.stuid }}" />
	    <select name="type" class="input-small">
	      <option value="student">Student</option>
	      <option value="guest" selected>Guest</option>
	      <option value="admin">Admin</option>
	    </select>
	    <input type="submit" value="Update!" />
	  </td>
	  </form>
	</tr>
      {% endfor %}
    </table>

    <table class="table">
      <thead>
	<th>Admins</th>
	<th>Actions</th>
      </thead>
      {% for admin in admins %}
        <tr>
	  <td>{{ admin.name }}</td>
	  <form target="_blank" action="change_user_type" method="POST">
	  <td>
	    <input type="hidden" name="user" value="{{ admin.stuid }}" />
	    <select name="type" class="input-small">
	      <option value="student">Student</option>
	      <option value="guest">Guest</option>
	      <option value="admin" selected>Admin</option>
	    </select>
	    <input type="submit" value="Update!" />
	  </td>
	  </form>
	</tr>
      {% endfor %}
    </table>


    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="{{options.base_url}}/{{options.static}}/js/admin/index.js"></script>

  </body>

</html>
