<html>

  <head>
    <title>OHMS Admin Panel</title>
    <link href="{{options.base_url}}/{{options.static}}/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{options.base_url}}/{{options.static}}/css/style.css" rel="stylesheet">
  </head>

  <body>

    <div class="span12">

    <h2>OHMS Admin Panel</h2>

    <hr/>

    <h3>Enter User View</h3>

    <p>This feature allows you to see the system from the perspective of any user. This is useful in case a student claims 
there is a problem with the system, and you would like to see what they're seeing.</p>

    <p><b><font color="red">Warning!</font></b> Once you enter the user's view, the link to this Admin Panel will no longer be visible 
from the main page. When you  are ready to switch back to your own view, you must type in the URL (<tt>/cgi-bin/index.cgi/admin</tt>) 
to return to this page. Once you are here, you can simply enter your User ID in the box below to return to your own view.</p>

    <form action="change_user" method="POST">
    User ID: <input type="text" name="user"/> <input type="submit" value="Enter View!"/>
    </form>

    <hr/>

    <h3>Gradebook</h3>

    <p class="lead">[<a href="download_grades">Download Grades as CSV</a>] 
      [<a href="download_peer_reviews">Download Peer Assessments as CSV</a>]</p>

    <strong>How to use the Gradebook:</strong>

    <ul>
      <li>Grades are only shown for students in the class. It is recommended that you change the 
status of any user who is not enrolled in the class to "Guest".</li>
      <li>Click on the name of any assignment to view a histogram of the scores for that 
assignment. This will also hide all columns except for that column, making it easier to 
enter scores.</li>
      <li>To excuse a student from an assignment, check the box next to his or her score. Then, the lost points on this assignment will not count against
	the student. You can verify this by looking at the denominator in
	the category total.</li>
    </ul>

    <table id="categories" class="table">
      <thead>
	<th>Categories</th>
	<th>Weight</th>
	<th>Drops</th>
      </thead>
      <tbody>
	{% for category in categories %}
	<tr id="{{ category.id }}">
	  <td><input type="text" class="input-medium" name="name" value="{{ category.name }}"/></td>
	  <td><input type="text" class="input-mini" name="weight" value="{{ category.weight }}"/>%</td>
	  <td><input type="text" class="input-mini" name="drops" value="{{ category.drops }}"/> <input type="button" value="Update!"/></td>
	</tr>
	{% endfor %}
	<tr id="new">
	  <td><input type="text" class="input-medium" name="name" value=""/></td>
	  <td><input type="text" class="input-mini" name="weight" value=""/>%</td>
	  <td><input type="text" class="input-mini" name="drops" value="0"/> <input type="button" value="Add!"/></td>
	</tr>
      </tbody>
    </table>

    <div align="center">
      <div id="histogram" class="span12"></div>
      <div id="missing" class="span12"></div>
      <div id="excused" class="span12"></div>
      <div id="stats" class="lead"></div>
    </div>

    <h4>Letter Grade Cutoffs</h4>

    <p>Enter the minimum percent needed for each letter grade. As you enter the 
      cutoffs, the letter grade will be automatically updated in the table below. 
      Please note that these cutoffs and letter grades are not saved. They will be 
      lost if you refresh the page.</p>

    <table class="table" id="cutoffs">
      <tr>
	<td>A+</td><td>A</td><td>A-</td>
	<td>B+</td><td>B</td><td>B-</td>
	<td>C+</td><td>C</td><td>C-</td>
	<td>D+</td><td>D</td><td>D-</td>
      </tr>
      <tr>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
	<td><input type="text" class="input-mini"/></td>
      </tr>
    </table>

    <table id="gradebook" class="table table-striped">
      <thead>
	<th>User ID</th>
	<th>Student Name</th>
	<th>Type</th>
	<th>Letter</th>

	<th><a href="#" onclick="hide_all_other_columns(5)">Overall</a></th>

	{% for category in categories %}
	<th><a href="#" onclick="hide_all_other_columns({{ 5 + loop.index }})">{{ category.name }} Total</a></th>
	{% endfor %}

	{% for homework in homeworks %}
	<th><a href="#" onclick="hide_all_other_columns({{ 5 + categories|length + loop.index }})">{{ homework.name }}</a></th>
	{% endfor %}
      </thead>
      <tbody>

	<tr class="warning">
	  <td><strike>&emsp;&emsp;&emsp;&emsp;</strike></td>
	  <td><b>Maximum</b></td>
	  <td><strike>&emsp;&emsp;&emsp;&emsp;</strike></td>
	  <td></td>
	  <td value="max"></td>
	  {% for category in categories %}
	  <td value="max"></td>
	  {% endfor %}
	  {% for hw in homeworks %}
	  <td value="max"><b>{{ max_scores[hw.id] }}</b></td>
	  {% endfor %}
	</tr>

	{% for student, grades in gradebook %}
        <tr stuid="{{ student.stuid }}">
	  <td>{{ student.stuid }}</td>
	  <td>{{ student.name }}</td>
	  <td style="white-space:nowrap;">
	    <form target="_blank" action="change_user_type" method="POST">
	      <input type="hidden" name="user" value="{{ student.stuid }}" />
	      <select name="type" class="input-small">
		<option value="student" selected>Student</option>
		<option value="guest">Guest</option>
		<option value="admin">Admin</option>
	      </select>
	      <input type="submit" value="Update!" />
	    </form>
	  </td>

	  <td class="letter"></td>
	  <td class="overall" value={{ grades["overall"]|round(3) }}>{{ grades["overall"]|round(1) }}%</td>

	  {% for category in categories %}
	  <td value={{ grades[category.name] }}>{{ grades[category.name] }}</td>
	  {% endfor %}
	  {% for hw in homeworks %}
	  <td hw_id="{{ hw.id }}" value="{% if hw.id in grades %}{{
					 grades[hw.id].score }}{% endif
					 %}">
	    {% if hw.questions|length %}
	      {% if hw.id in grades %}{{ grades[hw.id].score }}{% endif %}
	    {% else %}
	    <input type="text" class="grade" style="width: 40px; height: 30px;" 
		   value="{% if hw.id in grades %}{{ grades[hw.id].score }}{% endif %}"/>
	    {% endif %}
	    <input type="checkbox" class="excused" {% if hw.id in grades and grades[hw.id].excused %}checked{% endif %}/>
	  </td>
	  {% endfor %}
	</tr>
	{% endfor %}
      </tbody>
    </table>

    <hr/>

    <h3>Other Users</h3>

    <table class="table">
      <thead>
	<th>Guests</th>
	<th>Actions</th>
      </thead>
      {% for guest in guests %}
        <tr>
	  <td>{{ guest.name }}</td>
	  <form target="_blank" action="change_user_type" method="POST">
	  <td>
	    <input type="hidden" name="user" value="{{ guest.stuid }}" />
	    <select name="type" class="input-small">
	      <option value="student">Student</option>
	      <option value="guest" selected>Guest</option>
	      <option value="admin">Admin</option>
	    </select>
	    <input type="submit" value="Update!" />
	  </td>
	  </form>
	</tr>
      {% endfor %}
    </table>

    <table class="table">
      <thead>
	<th>Admins</th>
	<th>Actions</th>
      </thead>
      {% for admin in admins %}
        <tr>
	  <td>{{ admin.name }}</td>
	  <form target="_blank" action="change_user_type" method="POST">
	  <td>
	    <input type="hidden" name="user" value="{{ admin.stuid }}" />
	    <select name="type" class="input-small">
	      <option value="student">Student</option>
	      <option value="guest">Guest</option>
	      <option value="admin" selected>Admin</option>
	    </select>
	    <input type="submit" value="Update!" />
	  </td>
	  </form>
	</tr>
      {% endfor %}
    </table>

    </div>

    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="{{options.base_url}}/{{options.static}}/js/admin/index.js"></script>

  </body>

</html>
