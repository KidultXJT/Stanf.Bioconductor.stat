<html>

  <head>
    <title>Viewing Student Responses</title>
    <link href="{{options.static}}/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{options.static}}/css/style.css" rel="stylesheet">
  </head>

  <body>

    <div class='span12'>

    <h3>Viewing Student Responses</h3>

    <p class='lead'>Showing {{ user_responses|length }} Responses</p>

    <table class='table'>
      {% for user_response in user_responses %}
      <tr>
	<td class='span1'>  
	  <p>{{ user_response[0].name }}</p>
	  <p><tt>{{ user_response[1].sunet }}</tt></p>
	  <p>{{ user_response[1].time }}</p>
	</td><td class='span5'>
	  <ul>
	  {% for item_response in user_response[1].item_responses %}
	    <li>
	      <div style="white-space: pre-wrap">{{ item_response.response }}</div>
	    </li>
	  {% endfor %}
	  </ul>
	</td><td class='span6' {% if user_response[1].score != None %}style='background-color:#dff0d8;'{% endif %}>
	  <div class="response" id='{{ user_response[1].id }}'>
	    <table>
	      <tr>
		<td><b>Score:</b></td>
		<td>{{ user_response[1].score }}</td>
		<td><input class='input-mini' name='score' type='text'/></td>
	      </tr>
	      <tr>
		<td colspan="2"><b>Comments:</b>
		<div style="white-space: pre-wrap;">{{ user_response[1].comments|safe }}</div></td>
		<td><textarea name='comments' rows="5"></textarea></td>
	      </tr>
	      <tr>
		<td colspan=2></td>
		<td align='right'>
		  <button class='submit'>Update</button>
		</td>
	      </tr>
	    </table>
	  </div>
      </td></tr>
      {% endfor %}
    </table>

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript">
$(".submit").click(function () {
  var div = $(this).parents(".response").eq(0);
  var response_id = div.attr("id");
  var score = div.find("input").val();
  var comments = div.find("textarea").val();
  $.ajax({
    url : "update_response",
    type : "POST",
    dataType : "text",
    data : {
      response_id: response_id,
      score: score,
      comments: comments
    },
    success : function (data) {
      div.css("background-color", "#dff0d8");
    },
    error : function () {
      alert("Your update was not recorded successfully.");
    }
  })
})
    </script>


  </body>

</html>
